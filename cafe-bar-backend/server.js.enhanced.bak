const express = require('express');
const cors = require('cors');
const bodyParser = require('body-parser');
const { testConnection } = require('./config/database');

const app = express();
const PORT = process.env.PORT || 3000;

app.use(cors());
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: true }));

// Importar rutas
app.use('/api/categorias', require('./routes/categorias'));
app.use('/api/productos', require('./routes/productos'));
app.use('/api/mesas', require('./routes/mesas'));
app.use('/api/pedidos', require('./routes/pedidos'));
app.use('/api/inventario', require('./routes/inventario'));
app.use('/api/reportes', require('./routes/reportes'));

// Ruta de prueba
app.get('/', (req, res) => {
  res.json({ message: 'ğŸš€ API CafÃ© Bar reestructurada funcionando correctamente', version: '2.0.0' });
});

const startServer = async () => {
  const dbConnected = await testConnection();
  if (dbConnected) {
    app.listen(PORT, () => console.log(`ğŸš€ Servidor corriendo en http://localhost:${PORT}`));
  } else {
    console.error('âŒ No se pudo conectar a la base de datos');
    process.exit(1);
  }
};

startServer();
